
面试官你好，我叫刘尚阳，湖南长沙人，97年生，19年于安徽大学信息管理与信息系统专业毕业，毕业后就职于杭州海康威视总部，企事业群，在总部教育教学行业做普教教育局平台产品线，主要负责教学可视化组件和课堂巡查组件。整体教学的可视化报表都是我这边完成，以及视频监控巡检的业务。21年从总部异动到长沙分公司，主要负责湖南区域以及华中四省区域项目开发工作，湖南这边是 tob 的项目攻坚，面对的客户包含政府、公安、交警、以及一些企事业（工商企业）项目上会做一些项目的方案设计和评审。近两年随着能力提升，还会负责一些软件售前支撑，去现场客户或者用户沟通公司产品以及解决方案。

未来的职业发展规划


项目难点：

- 可视化难点
	- 动效难点，动效有一个像电路板数据汇聚一样的效果，这里是使用了 gsap 的 timeline 功能和 motionPathPlugin 。与设计进行几个关键性参数的考究，整体把控动效时间轴的几个补间动画。 motionPath 是实现不规则动画，这里采用的方案是 svg 的路径去引导不规则动画。同样通过 timeline 的功能实现时间控制。
	- echarts
	- 领导驾驶舱
- 人员追踪任务
	- 异步任务处理，新建的追踪任务会下发到后端，然后 ws 推送任务状态，该任务查询条件存和 ws 推送结果储到vuex进行状态管理，执行中的任务状态在打开详情和返回列表的时候都能获取的到，执行完的任务直接查询任务详情。
	- 详情页面，根据当前vuex的数据内容展示人员抓拍，人员轨迹。
		- 封装了抓拍回放、地图弹窗详情等。
		- 封装了新增任务，新的抓拍图可以作为子任务查询条件，继续生成新的任务放到任务队列里面。跟主任务的表单一部分内容是一致的。并且这个功能也是
		- 任务结束展示人员轨迹，轨迹播放，任务不结束，数据往地图上进行打点动态展示。有一种数据一个个被找出来的科技感。
- 地图部分
	- 轨迹播放
		- 整体思路是
			- 分析数据，数据是经纬度和抓拍时间。数据量大概在两位数。
			- 时间轴控制当前播放时间位置。
			- 计算播放时间的当前时间在哪两个经纬度数据之间。
			- 起点A、终点B、移动的总时间、移动的速度曲线（匀速、加速、缓动缓停等等），然后就可以根据当前时刻在总时长的进度获得NPC应该在的位置
			- 这样有一个好处是可以具体每一段的行动快慢可以看得出来。
		- 优化点
			- 数据只保留必要id，时间轴控件双向绑定一个时间值。点击时，根据时间计算处于哪两个时间节点中间，减轻地图模块数据查找的负担，专注计算地图位置信息。
			- 状态不会重复计算，而是通过编号自然+1，从而减少计算量。运行到下一个轨迹，只有在时间被点击之后或者快进快退功能才会重新计算一次在哪两个时间之间。
			- 这样也方便计算高亮。哪个路段正处于播放状态。不然点位
			- 这里最终使用的是 background 百分比去实现进度条的加载 也是减轻重流负担。
	- 经纬度兼容 3857 和 4326，这里是地图封装到了一个 hooks 里，处理经纬度的地方都收敛到了这里，比如要打点上图，就 add 一个数据到某个layer上，在add 的过程中会判断传入坐标系和当前地图接入坐标系的关系。
	- 地图实例不挂在 vue 响应式对象里
	- 周边监控点做了聚合和一杆多点的判断。根据当前可视域去处理。
	- 范围追踪上监控点可以圈选，然后可以多边形合并。

******


- 国安局融合通信
	- 地图引擎、人员轨迹、轨迹播放
	- 业务流程复杂，追踪任务后，任务还可以多个方式创建子任务。还可以根据当前的目标检索结果继续创建子任务。

- 公安警务大数据
	- 话单研判
		- 用 xlsx.js 解析上传文件，然后把结果集预先采样给用户，用户根据表格的列数据区调整自己想上传的表单数据，最后确认了再去上传
		- 有个关系图，echarts卡顿，最后是用 GraphVis 去实现的关系图。
		- 业务围绕号码来做的，有的号码要求实现研判备注或者号码分析，提前设计了一些通用组件，后面用户在演示过程中提到这部分实战对号码都需要支持这些功能，很快的复用了。
	- 未成年人管控
		- 可疑人挖掘任务

- 教学行业
	- 可视化组件
		- echarts、GSAP 等工具去实现视觉设计的动效。TimelineLite 控制动画的执行顺序和时间线，减少不必要的计算
		- 
	- 巡课组件
		- 主要是视频控件的攻克，最开始视频控件要拉起c++，要升级到h5player ，然后实现 云台、电子放大、语音对讲等。

项目难点


【背景 & 问题】

从现场反馈回来的一个问题：

郴州市“智慧交管”一期工程项目交通态势是一个`5760*2160`的超高分可视化大屏，大屏包括两侧数据看板以及中间hmap地图应用。现场演示时出现超高分大屏出现崩溃、未响应、明显拖动卡顿的问题，并且稳定复现。

【根因分析】

1. 由于超高分可视化项目对硬件需要一定的性能支持，首先排查了现场设备的可靠性，发现是专业级英伟达Quadro P5000显卡做的屏幕合并输出，因此初步排除设备性能不足问题

2. 排查network请求状态，发现大部分接口存在阻塞pending状态，并且发现崩溃会频发在出现在页面移动的情况，而chrome最大同域并发请求数仅为6，因此分析有以下几个问题点：

    2.1 地图应用对接的是第三方超图的底图，WMTS服务是http协议，后端通过Nginx代理转发解决跨域问题。但是同时也增加了同域下的请求并发数，占用了并发导致请求阻塞

    2.2 由于可视化大屏是`5760*2160`超高分大屏，在设计地图应用时，是将地图作为背景加载的，地图铺满了屏幕，而第三方超图地图瓦片是常规的`256*256`大小，导致需要加载的瓦片数量过多，增加了请求数量

3. 应用层面分析发现如下问题：

    3.1 郴州市所有道路卡口、监控点数据量过大，对地图渲染过程产生压力导致页面渲染卡顿崩溃，需要做聚合操作

    3.2 页面会将所有状态的路网拥堵数据返回，郴州所有路网数据体量过大，页面卡顿。

    3.3 页面部分开发滚动动画使用的是 scrollTop++ 修改滚动高度，会让浏览器不断产生重绘，消耗性能

【行动步骤 & 方案执行】

1. 针对后端用Nginx代理解决底图跨域问题，将代理取消，让超图提供支持https协议的地图资源，增加不同域下的请求并发

2. 针对超高分瓦片数量请求过多问题，向第三方沟通提供`512*512`尺寸的切图资源。并且将地图渲染尺寸集中在可视化大屏中心，两侧图表位置不做透明穿透效果，减少地图渲染尺寸从而减少地图的瓦片请求数量

3. 路网数据将过滤畅通数据，只展示缓行、拥堵及以上数据，修改道路颜色为绿色，将畅通数据的绿色直接作为地图底图渲染，大幅度降低数据量

4. 针对道路监控点上图问题，修改为聚合方式

5. 针对部分不合理动效进行优化，修改为css动效方式，减少重绘